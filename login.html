<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FocusFlow | Secure Access</title>
    <style>
        :root {
            --bg: #0b1121; --card: #1e293b; --accent: #38bdf8;
            --text: #f8fafc; --muted: #94a3b8; --danger: #ef4444;
        }

        body {
            font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text);
            margin: 0; display: flex; justify-content: center; align-items: center;
            min-height: 100vh; padding: 20px;
        }

        .auth-container {
            background: var(--card); padding: 40px; border-radius: 24px;
            width: 100%; max-width: 400px; border: 1px solid #334155; text-align: center;
        }

        h1 { font-size: 2rem; margin: 0 0 10px 0; color: var(--accent); }
        p { color: var(--muted); margin-bottom: 30px; font-size: 0.9rem; }

        .input-group { text-align: left; margin-bottom: 15px; }
        label { display: block; font-size: 0.75rem; margin-bottom: 8px; text-transform: uppercase; font-weight: bold; }
        
        input {
            width: 100%; background: #0f172a; border: 1px solid #334155;
            color: white; padding: 12px; border-radius: 10px; box-sizing: border-box;
            outline: none; transition: 0.3s;
        }

        /* Visual feedback for invalid format */
        input:focus { border-color: var(--accent); }
        input.invalid { border-color: var(--danger); }

        .btn-primary {
            width: 100%; background: var(--accent); color: #000;
            border: none; padding: 14px; border-radius: 10px;
            font-weight: bold; cursor: pointer; margin-top: 10px;
        }

        .btn-guest {
            width: 100%; background: transparent; color: var(--muted);
            border: 1px solid #334155; padding: 12px; border-radius: 10px;
            cursor: pointer; margin-top: 15px;
        }

        #error-msg { color: var(--danger); font-size: 0.8rem; margin-top: 15px; display: none; }
        #name-group { display: none; }
    </style>
</head>
<body>

<div class="auth-container">
    <h1 id="auth-title">Welcome Back</h1>
    <p id="auth-subtitle">Login to access your study portal</p>

    <div class="input-group" id="name-group">
        <label>Full Name</label>
        <input type="text" id="fullname" placeholder="John Doe">
    </div>

    <div class="input-group">
        <label>Email Address</label>
        <input type="email" id="email" placeholder="example@email.com" required>
    </div>

    <div class="input-group">
        <label>Password</label>
        <input type="password" id="password" placeholder="Min. 6 characters" required>
    </div>

    <button class="btn-primary" id="main-btn" onclick="handleAuth()">Login</button>
    <button class="btn-guest" onclick="skipLogin()">Continue as Guest</button>

    <div id="error-msg"></div>

    <div class="toggle-text" style="margin-top:20px; font-size:0.85rem; color:var(--muted);">
        <span id="toggle-area" onclick="toggleMode()" style="color:var(--accent); cursor:pointer; font-weight:bold;">Create an account</span>
    </div>
</div>

<script>
    let isLoginMode = true;

    function toggleMode() {
        isLoginMode = !isLoginMode;
        document.getElementById('auth-title').innerText = isLoginMode ? "Welcome Back" : "Join FocusFlow";
        document.getElementById('main-btn').innerText = isLoginMode ? "Login" : "Sign Up";
        document.getElementById('name-group').style.display = isLoginMode ? "none" : "block";
        document.getElementById('toggle-area').innerText = isLoginMode ? "Create an account" : "Already a member? Login";
    }

    function validateEmail(email) {
        // Strict Regex for proper email format: name@domain.com
        const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return re.test(email);
    }

    function handleAuth() {
        const emailInput = document.getElementById('email');
        const passInput = document.getElementById('password');
        const nameInput = document.getElementById('fullname');
        const error = document.getElementById('error-msg');

        const email = emailInput.value.trim();
        const pass = passInput.value;
        const name = nameInput.value.trim();

        error.style.display = "none";
        emailInput.classList.remove('invalid');

        // 1. Strict Format Validation
        if (!validateEmail(email)) {
            emailInput.classList.add('invalid');
            error.innerText = "Please enter a valid email address (e.g., user@mail.com).";
            error.style.display = "block";
            return;
        }

        if (pass.length < 6) {
            error.innerText = "Password must be at least 6 characters long.";
            error.style.display = "block";
            return;
        }

        if (isLoginMode) {
            // LOGIN LOGIC
            const storedEmail = localStorage.getItem('ff_user_email');
            const storedPass = localStorage.getItem('ff_pass');

            if (email === storedEmail && pass === storedPass) {
                sessionStorage.setItem('isLoggedIn', 'true');
                window.location.href = "index.html";
            } else {
                error.innerText = "No account found with these credentials.";
                error.style.display = "block";
            }
        } else {
            // SIGN UP LOGIC
            if (!name) {
                error.innerText = "Please enter your full name.";
                error.style.display = "block";
                return;
            }

            localStorage.setItem('ff_fname', name.split(' ')[0]);
            localStorage.setItem('ff_lname', name.split(' ').slice(1).join(' '));
            localStorage.setItem('ff_user_email', email);
            localStorage.setItem('ff_pass', pass);
            
            alert("Success! Account created for " + name);
            toggleMode();
        }
    }

    function skipLogin() {
        sessionStorage.setItem('isLoggedIn', 'true');
        localStorage.setItem('ff_fname', "Guest");
        localStorage.setItem('ff_user_email', "guest@focusflow.local");
        window.location.href = "index.html";
    }
</script>
</body>
</html>
